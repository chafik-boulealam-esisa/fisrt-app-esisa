// Prisma Schema for Student Management System
// Uses PostgreSQL for Vercel deployment

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// User model for authentication and authorization
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  firstName     String
  lastName      String
  role          String    @default("user") // "admin" or "user"
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastLogin     DateTime?
  
  // Relations
  students      Student[] @relation("CreatedBy")
  securityLogs  SecurityLog[]

  @@index([email])
  @@index([role])
}

// Student model for student records
model Student {
  id             String   @id @default(cuid())
  studentId      String   @unique // e.g., ESISA-2024-001
  firstName      String
  lastName       String
  email          String   @unique
  dateOfBirth    DateTime?
  gender         String?  // "male", "female", "other"
  phone          String?
  address        String?
  city           String?
  country        String?
  postalCode     String?
  enrollmentDate DateTime @default(now())
  program        String?
  year           Int      @default(1)
  gpa            Float    @default(0.0)
  status         String   @default("active") // "active", "inactive", "graduated", "suspended"
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // Relations
  createdBy      User?    @relation("CreatedBy", fields: [createdById], references: [id])
  createdById    String?

  @@index([studentId])
  @@index([email])
  @@index([status])
  @@index([program])
}

// Security Log for audit trail
model SecurityLog {
  id        String   @id @default(cuid())
  action    String
  ipAddress String?
  userAgent String?
  details   String?  // JSON string for additional details
  createdAt DateTime @default(now())
  
  // Relations
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?

  @@index([userId])
  @@index([action])
  @@index([createdAt])
}
